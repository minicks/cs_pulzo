# 인증 방식 별 차이(세션, 쿠키, JWT)

### 인증과 인가

인증(Authentication): 사용자의 상태가 어떤지(로그인 여부), 사용자가 누구인지 확인하는 것

인가(Authorization): 인증 받은 사용자의 권한을 확인하는 것

### 인증 방식이 필요한 이유

http 통신은 stateless 함. 즉 요청이 독립적으로 처리됨.

하나의 요청이 끝나면 서버는 요청한 사람이 누군지 잊어버림.

그렇다고 매번 다시 로그인하는 것은 불편하니, 요청할 때마다 요청하는 사람이 누구인지 서버에 알려주기 위해 쿠키-세션, JWT 토큰 등 인증 방식을 사용함.

## 쿠키, 세션 방식

### 쿠키

서버에서 브라우저로 전달한 작은 데이터 / 서버- 클라이언트 대화 수단

사이트에 방문→ 브라우저가 서버에 필요한 요청을 함 → 서버는 응답을 줌. 이때 쿠키가 있을 수 있음 → 브라우저는 쿠키를 받으면 브라우저에 저장함. → 그 사이트에 방문해서 요청 보낼 때마다 쿠키를 함께 보냄.

- 특정 도메인에서 생성된 쿠키는 그 도메인에서만 사용됨

참고) 크롬 익스텐션 (Cookie-Editor)을 사용하면, 그 도메인에서 받아서 브라우저가 저장하고 있는 쿠키를 쉽게 볼 수 있음

![Untitled](https://user-images.githubusercontent.com/68271159/173360114-52c1dec6-9393-4489-9c60-754b138f6eb0.png)

- 쿠키는 인증에만 쓰이는 게 아니라, 다른 데에도 쓰임(예- 웹 사이트 언어 설정, 팝업 일주일 간 보지 않기, 장바구니 등등). 보안과 관련 없을 때는 쿠키만으로 처리 가능함.
- 쿠키만으로 인증을 하지는 않음. 쿠키 만으로 인증을 한다면 ? 쿠키 안의 정보가 조작될 수 있고, 중간에 해커가 http 요청을 가로채면 민감한 정보도 빼앗기는 것.
  ⇒ 쿠키, 세션을 같이 사용함. 클라이언트는 서버에 요청보낼 때 쿠키를 같이 보내고, 서버는 이 쿠키를 받아서 세션 정보에 접근하는 식으로 인증함.
  (세션: 서버-클라이언트 연결이 활성화된 상태)

### 쿠키-세션 인증 과정

![Untitled 1](https://user-images.githubusercontent.com/68271159/173360013-3d3f52be-f45c-4d71-9742-46ea840a5703.png)

### 특징

중요한 유저 정보는 서버에 있고, 클라이언트는 세션 아이디만 가짐.

세션은 쿠키를 기반으로 동작한다.

### 장점

1. 로그인한 유저의 상태를 제어 가능함(로그인한 모든 디바이스 보여주고 원치 않는 디바이스에서 강제 로그아웃 시키기, 한 계정으로 하나의 기기에서만 접속되게 하기 등)
2. http 요청 노출되어서, 쿠키에 있는 세션 아이디 값을 탈취당해도 그 값 자체는 큰 의미가 없음. 중요한 정보는 서버에 있음.
3. 쿠키에 있는 세션 아이디는 고유한 값이라서, 어떤 회원인지 바로 확인 가능함.

### 단점

1. 로그인한 유저들의 모든 세션 정보를 저장할 DB 공간이 필요함.
2. 서버 부하가 생길 수 있음(인증을 해야 할 때마다 매번 세션 저장소에 접근해야 함)
3. 세션 하이재킹 공격(로그인된 상태를 가로채는 것) 해커가 http 요청에서 세션 아이디가 포함된 쿠키를 훔칠 수 있음. 이를 가지고 서버에 요청을 보내면, 서버가 그 사용자인 줄 알고 잘못 처리할 수 있음 ⇒ https를 이용해 요청 탈취 당해서 정보 읽기 어렵게 만들기.

## Json Web Token 토큰 기반 인증

토큰: 암호화된 문자열

JWT 토큰 : JSON Web Token. 인증에 필요한 정보를 암호화한 토큰.

- 마침표 기준으로 세 부분으로 나뉨

1. 헤더(header): 암호화하는 알고리즘 방식(서명 값 만들 때 사용할 알고리즘), 토큰의 타입
2. 페이로드(payload): 서버에 보낼 데이터. 유저 아이디, 토큰의 유효기간, 관리자인지 여부 등
3. 서명(verify signature): 헤더, 페이로드, 시크릿 키를 더한 뒤 서명한 값. 시크릿 키는 서버만 알고 있음. 클라이언트에서 JWT 토큰을 받은 뒤, 유효성 검증을 할 때 사용.

- 헤더, 페이로드는 디코딩해서 확인할 수 있음. 페이로드에 민감한 정보를 보내면 안됨.
- 관련 사이트: [https://jwt.io/](https://jwt.io/)

### JWT 토큰 인증 과정

![Untitled 2](https://user-images.githubusercontent.com/68271159/173360071-1733de5e-b3a1-4d99-bb39-10672b59a896.png)

### 장점

1. 별도의 저장소가 필요하지 않음
2. 확장성: oauth 로그인 등 토큰 기반 인증 시스템을 사용할 때
3. 서버 부하 감소: 인증할 때 서버에 DB에 접근해서 일하지 않아도 됨. JWT 토큰 검증만 하면 됨.

### 단점

1. 이미 발급된 토큰은 유효 기간이 지날 때까지 계속 사용이 가능함. (토큰이 탈취된 것 알아도 강제 로그아웃 못 시킴)

   ⇒ 대책: access token은 유효 기간을 짧게 하고, refresh token은 유효 기간을 길게 해서 사용하는 방법.

2. payload에는 중요한 정보를 넣지 못함
3. jwt 토큰 길이가 길어서, 서버의 자원 낭비가 발생함

### 세션-쿠키 vs. JWT 토큰

세션-쿠키 방식에서는 세션 저장소에 유저 정보를 저장함. ↔ JWT 토큰 방식에서는 토큰 안에 유저 정보가 있음.

클라이언트는 세션-쿠키 방식의 경우 쿠키를, JWT 토큰 방식의 경우 access token을 실어서 서버에 요청을 보냄.

서버는 세션-쿠키 방식의 경우 쿠키의 세션 아이디를 통해서 세션 저장소에 접근해서 어떤 유저인지 파악하고, JWT 토큰 방식의 경우 JWT 토큰을 decode해서 토큰이 조작되었는지, 기간이 만료되었는지, 유저가 누구인지 파악함.

웹 사이트 규모, 사용자 계정을 어떻게 관리할 것인지(1계정 1기기 로그인 등이 필요한지 등) 등에 따라서 인증 방식을 선택하자.

### 참고 자료

[Cookie, Session, Token 의 차이점](https://tofusand-dev.tistory.com/89)

[쿠키, 세션, 토큰에 관하여](https://seoramyeon.tistory.com/48)

[https://www.youtube.com/watch?v=tosLBcAX1vk](https://www.youtube.com/watch?v=tosLBcAX1vk)

[https://www.youtube.com/watch?v=1QiOXWEbqYQ](https://www.youtube.com/watch?v=1QiOXWEbqYQ)

[[HTTP] 쿠키, 세션, JWT](https://velog.io/@say_ye/HTTP-%EC%BF%A0%ED%82%A4-%EC%84%B8%EC%85%98)

- 이미지는 미리캔버스에서 만듦.
